### @name mfa_totp_setup
POST {{host}}/auth/mfa/totp/setup
Authorization: {{authHeader}}
Accept: application/json

> {%
    const TAG = "mfa/totp/setup";
    client.log("[" + TAG + "] " + request.method + " " + request.url + " -> " + response.status + " " + response.statusText);
    client.log("[" + TAG + "] request.body=" + (request.body || ""));
    client.log("[" + TAG + "] response.body=" + response.body);

    try {
        const data = JSON.parse(response.body);
        if (data && data.secretBase32) {
            client.env.set("totpSecret", data.secretBase32);
            client.log("[" + TAG + "] saved totpSecret=" + data.secretBase32);
        }
        if (data && data.otpauthUrl) {
            client.env.set("otpauthUrl", data.otpauthUrl);
            client.log("[" + TAG + "] saved otpauthUrl=" + data.otpauthUrl);
        }
        if (data && Array.isArray(data.backupCodes)) {
            client.env.set("backupCodes", data.backupCodes.join(","));
            client.log("[" + TAG + "] saved backupCodes (" + data.backupCodes.length + " codes)");
        }
    } catch (e) {
        client.log("[" + TAG + "] non-JSON response");
    }
%}

### @name mfa_totp_enable
POST {{host}}/auth/mfa/totp/enable?code={{mfaCode}}
Authorization: {{authHeader}}
Accept: application/json

> {%
    const TAG = "mfa/totp/enable";
    client.log("[" + TAG + "] " + request.method + " " + request.url + " -> " + response.status + " " + response.statusText);
    client.log("[" + TAG + "] request.body=" + (request.body || ""));
    client.log("[" + TAG + "] response.body=" + response.body);
    client.env.set("mfaEnabled", "true");
%}

### @name mfa_totp_disable
POST {{host}}/auth/mfa/totp/disable?code={{mfaCode}}
Authorization: {{authHeader}}
Accept: application/json

> {%
    const TAG = "mfa/totp/disable";
    client.log("[" + TAG + "] " + request.method + " " + request.url + " -> " + response.status + " " + response.statusText);
    client.log("[" + TAG + "] request.body=" + (request.body || ""));
    client.log("[" + TAG + "] response.body=" + response.body);
    client.env.set("mfaEnabled", "false");
%}
